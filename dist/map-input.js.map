{"version":3,"file":"map-input.js","sources":["../src/map-input.js"],"sourcesContent":["import { ZoomInput } from './zoomInput.js';\nimport { HiddenInput } from './hiddenInput.js';\nimport { WidthInput } from './widthInput.js';\nimport { HeightInput } from './heightInput.js';\nimport { LocationInput } from './locationInput.js';\n\nexport class MapInput extends HTMLElement {\n  static get observedAttributes() {\n    return [\n      'name',\n      'type',\n      'value',\n      'axis',\n      'units',\n      'position',\n      'rel',\n      'min',\n      'max',\n      'step'\n    ];\n  }\n\n  get name() {\n    return this.getAttribute('name');\n  }\n  set name(val) {\n    if (val) {\n      this.setAttribute('name', val);\n    }\n  }\n  get type() {\n    return this.getAttribute('type');\n  }\n  set type(val) {\n    if (['location'].includes(val)) {\n      this.setAttribute('type', val);\n    }\n  }\n  get value() {\n    return this.input.getValue();\n  }\n  set value(val) {\n    if (val) {\n      this.setAttribute('value', val);\n    }\n  }\n  get axis() {\n    return this.getAttribute('axis');\n  }\n  set axis(val) {\n    if (val) {\n      this.setAttribute('axis', val);\n    }\n  }\n  get units() {\n    return this.getAttribute('units');\n  }\n  set units(val) {\n    if (val) {\n      this.setAttribute('units', val);\n    }\n  }\n  get position() {\n    return this.getAttribute('position');\n  }\n  set position(val) {\n    if (val) {\n      this.setAttribute('position', val);\n    }\n  }\n  get rel() {\n    return this.getAttribute('rel');\n  }\n  set rel(val) {\n    if (val) {\n      this.setAttribute('rel', val);\n    }\n  }\n  get min() {\n    if (\n      this.type === 'height' ||\n      this.type === 'width' ||\n      this.type === 'hidden'\n    ) {\n      return null;\n    }\n    if (this.getAttribute('min')) {\n      return this.getAttribute('min');\n    } else if (this._layer._layerEl.querySelector('map-meta[name=zoom]')) {\n      // fallback map-meta on layer\n      return M._metaContentToObject(\n        this._layer._layerEl\n          .querySelector('map-meta[name=zoom]')\n          .getAttribute('content')\n      ).min;\n    } else {\n      // fallback map min\n      return this._layer._layerEl.extent.zoom.minZoom.toString();\n    }\n  }\n  set min(val) {\n    if (val) {\n      this.setAttribute('min', val);\n    }\n  }\n  get max() {\n    if (\n      this.type === 'height' ||\n      this.type === 'width' ||\n      this.type === 'hidden'\n    ) {\n      return null;\n    }\n    if (this.getAttribute('max')) {\n      return this.getAttribute('max');\n    } else if (this._layer._layerEl.querySelector('map-meta[name=zoom]')) {\n      // fallback map-meta on layer\n      return M._metaContentToObject(\n        this._layer._layerEl\n          .querySelector('map-meta[name=zoom]')\n          .getAttribute('content')\n      ).max;\n    } else {\n      // fallback map max\n      return this._layer._layerEl.extent.zoom.maxZoom.toString();\n    }\n  }\n  set max(val) {\n    if (val) {\n      this.setAttribute('max', val);\n    }\n  }\n  get step() {\n    if (this.type !== 'zoom') {\n      return null;\n    } else {\n      return this.getAttribute('step') || '1';\n    }\n  }\n  set step(val) {\n    if (val) {\n      this.setAttribute('step', val);\n    }\n  }\n  attributeChangedCallback(name, oldValue, newValue) {\n    switch (name) {\n      case 'name':\n        if (oldValue !== newValue) {\n          // update associated class value on attribute change\n          if (oldValue !== null) {\n            this.input.name = newValue;\n          }\n        }\n        break;\n      case 'type':\n        if (oldValue !== newValue) {\n          // handle side effects\n          // not allowed to change 'type'\n        }\n        break;\n      case 'value':\n        if (oldValue !== newValue) {\n          if (oldValue !== null) {\n            this.input.value = newValue;\n          } else {\n            this.initialValue = newValue;\n          }\n        }\n        break;\n      case 'axis':\n        if (oldValue !== newValue && this.input) {\n          // handle side effects\n          this.input.axis = newValue;\n        }\n        break;\n      case 'units':\n        if (oldValue !== newValue && this.input) {\n          // handle side effects\n          this.input.units = newValue;\n        }\n        break;\n      case 'position':\n        if (oldValue !== newValue && this.input) {\n          // handle side effects\n          this.input.position = newValue;\n        }\n        break;\n      case 'rel':\n        if (oldValue !== newValue && this.input) {\n          // handle side effects\n          this.input.rel = newValue;\n        }\n        break;\n      case 'min':\n        if (oldValue !== newValue && this.input) {\n          // handle side effects\n          this.input.min = newValue;\n        }\n        break;\n      case 'max':\n        if (oldValue !== newValue && this.input) {\n          // handle side effects\n          this.input.max = newValue;\n        }\n        break;\n      case 'step':\n        if (oldValue !== newValue && this.input) {\n          // handle side effects\n          this.input.step = newValue;\n        }\n        break;\n    }\n  }\n  constructor() {\n    // Always call super first in constructor\n    super();\n  }\n  async connectedCallback() {\n    await this.parentElement.whenReady();\n    if (this.parentElement.nodeName === 'MAP-EXTENT') {\n      this._layer = this.parentElement._layer;\n    }\n    switch (this.type) {\n      case 'zoom':\n        // input will store the input Class specific to the input type\n        this.input = new ZoomInput(\n          this.name,\n          this.min,\n          this.max,\n          this.initialValue,\n          this.step,\n          this._layer\n        );\n        break;\n      case 'location':\n        // input will store the input Class specific to the input type\n        this.input = new LocationInput(\n          this.name,\n          this.position,\n          this.axis,\n          this.units,\n          this.min,\n          this.max,\n          this.rel,\n          this._layer\n        );\n        L.DomEvent.on(\n          this.parentElement._layer._map,\n          'click',\n          this._query,\n          this\n        );\n        break;\n      case 'width':\n        // input will store the input Class specific to the input type\n        this.input = new WidthInput(this.name, this._layer);\n        break;\n      case 'height':\n        // input will store the input Class specific to the input type\n        this.input = new HeightInput(this.name, this._layer);\n        break;\n      case 'hidden':\n        // input will store the input Class specific to the input type\n        this.input = new HiddenInput(this.name, this.initialValue);\n        break;\n    }\n  }\n\n  disconnectedCallback() {}\n\n  _query(event) {\n    this.input.clicki = event.latlng.lat;\n    this.input.clickj = event.latlng.lng;\n  }\n\n  //https://developer.mozilla.org/en-US/docs/Web/API/HTMLInputElement/checkValidity\n  checkValidity() {\n    if (this.input.validateInput()) {\n      return true;\n    } else {\n      const evt = new Event('invalid', {\n        bubbles: true,\n        cancelable: true,\n        composed: true\n      });\n      this.dispatchEvent(evt);\n      return false;\n    }\n  }\n\n  //https://developer.mozilla.org/en-US/docs/Web/API/HTMLInputElement/reportValidity\n  reportValidity() {\n    if (this.input.validateInput()) {\n      return true;\n    } else {\n      const evt = new Event('invalid', {\n        bubbles: true,\n        cancelable: true,\n        composed: true\n      });\n      this.dispatchEvent(evt);\n      //if the event isn't canceled reports the problem to the user.\n      // https://html.spec.whatwg.org/multipage/form-control-infrastructure.html#dom-cva-reportvalidity-dev\n      console.log(\"Input type='\" + this.type + \"' is not valid!\");\n      return false;\n    }\n  }\n  whenReady() {\n    return new Promise((resolve, reject) => {\n      let interval, failureTimer;\n      if (this.input) {\n        resolve();\n      } else {\n        let inputElement = this;\n        interval = setInterval(testForInput, 300, inputElement);\n        failureTimer = setTimeout(inputNotDefined, 10000);\n      }\n      function testForInput(inputElement) {\n        if (inputElement.input) {\n          clearInterval(interval);\n          clearTimeout(failureTimer);\n          resolve();\n        }\n      }\n      function inputNotDefined() {\n        clearInterval(interval);\n        clearTimeout(failureTimer);\n        reject('Timeout reached waiting for input to be ready');\n      }\n    });\n  }\n}\n"],"names":["ZoomInput","HiddenInput","WidthInput","HeightInput","LocationInput","MapInput","HTMLElement","observedAttributes","name","this","getAttribute","val","setAttribute","type","includes","value","input","getValue","axis","units","position","rel","min","_layer","_layerEl","querySelector","M","_metaContentToObject","extent","zoom","minZoom","toString","max","maxZoom","step","attributeChangedCallback","oldValue","newValue","initialValue","constructor","super","connectedCallback","parentElement","whenReady","nodeName","L","DomEvent","on","_map","_query","disconnectedCallback","event","clicki","latlng","lat","clickj","lng","checkValidity","validateInput","evt","Event","bubbles","cancelable","composed","dispatchEvent","reportValidity","console","log","Promise","resolve","reject","let","interval","failureTimer","setInterval","inputElement","clearInterval","clearTimeout","setTimeout"],"mappings":"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"}